<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="initial-scale=1">
	<!-- <meta name="viewport" content="user-scalable=no"> -->
	<title>Справочник</title>
	<link rel="stylesheet" href="css/touch-menu-la.css">
	<link rel="stylesheet" href="css/style.css">
</head>
<body>
	<div class="block-1">
		<header class="clearfix">
			<div class="button" id="menu-open">
				<span></span>
				<span></span>
				<span></span>
			</div>
			<div class="name">Computers</div>
			<div class="search">
				<span></span>
				<span></span>
				<span></span>
			</div>
		</header>
		
		<div class="content">
			Lorem ipsum dolor sit amet, consectetur adipisicing elit. Molestiae, possimus quidem eaque iusto necessitatibus dolor neque accusamus vitae ad. Officiis ab aliquam natus perspiciatis velit sequi nisi enim ipsum rem fuga sunt consectetur, illum consequuntur illo, amet debitis cum alias error aspernatur a quaerat at culpa, tenetur. Odit atque accusantium reprehenderit, ex sunt maiores suscipit aperiam error asperiores ratione accusamus iste ut, id laboriosam dolor, voluptate, deserunt. Delectus numquam harum eveniet explicabo, neque vero accusamus totam quae minus earum soluta illo eius libero. Temporibus odit alias, iste iusto ex illum dolor enim corporis, consectetur vel qui laborum id ipsum nihil autem animi nobis sit ab nesciunt molestias. Modi in eveniet autem unde laborum corporis ipsa nostrum obcaecati alias necessitatibus consectetur sequi et natus illum, ex. Sapiente, ad, porro facere officia illum quos minus temporibus incidunt. Magni dolorum voluptatem ipsum repellat tempora, modi error numquam repudiandae assumenda, nostrum aperiam id eius reprehenderit maiores earum nemo labore distinctio excepturi, ratione quis in perspiciatis? Tempore atque, dicta reprehenderit consequuntur veritatis doloribus vero, possimus placeat ab quaerat. Ipsum distinctio, saepe perferendis tempore, vero sed praesentium non quia assumenda sunt eos possimus fugit? Aliquid similique sapiente aliquam tempora eum earum aspernatur! Similique perferendis, quam quaerat repellendus, maxime sed quod quasi ab assumenda provident, quia. Facere dolores nulla numquam quos cum, nobis eveniet quidem eaque reiciendis voluptates quae quam officia dolor, iusto consectetur perspiciatis architecto harum saepe, ipsa sapiente nam laborum sed. Pariatur quia est, minima ut quisquam debitis aspernatur fuga nulla dolorum! Ducimus, architecto aliquam?
		</div>

		<div class="touch-menu-la color" id="menu">
			<div class="menu">
				<nav>
					<ul>
						<li><a href="#">Установка</a></li>
						<li><a href="#">Сборка</a></li>
						<li><a href="#">Переустановка</a></li>
					</ul>
				</nav>
			</div>
		</div>
	</div>

	<script src="scripts/jquery-3.1.1.min.js"></script>
	<script src="scripts/hammer.min.js"></script>
	<script src="scripts/touch-menu-la.min.js"></script>
	<script src="scripts/jquery.touchSwipe.min.js"></script>
	<script>
		const proc = 85;
		const opacity = 0.7;
		var pos = 0;
		var width, width_w = window.innerWidth;
		var width_h = window.innerHeight;
		if (width_w > width_h)
			width = proc * width_h / 100;
		else
			width = proc * width_w / 100;
		$('.content').css({'height' : width_h - 40 - 30});
		var TouchMenu = TouchMenuLA({
			target: document.getElementById('menu'),
			width: width,
			maxMaskOpacity: opacity,
			onOpen: function(){
				//запрещаем скролить окно
				$('body').css({'overflow' : 'hidden'});
				//animation visible ukz
			},
			onClose: function(){
				//скролить окно
				$('body').css({'overflow-y' : 'scroll'});
				//animation visible ukz
			}
		});
		document.getElementById('menu-open').addEventListener('click', function(){
			TouchMenu.toggle();
		});
		$.fn.touchScrolling = function(){
    		var startPos = 0;
        	self = $(this);
        	self.bind('touchstart', function(e) {
        		startPos = self.scrollTop() + e.touches[0].pageY;
        		e.preventDefault();
        	});
		    self.bind('touchmove', function(e) {
		        self.scrollTop(startPos - e.touches[0].pageY);
		        e.preventDefault();
		    });
		};
		//hover menu
		$('.color .menu li').bind('touchstart', function(e){
			$('.color .menu li').each(function(index){
				$(this).removeClass('active');
			});
			$(this).addClass('active');
		});
		$('.color .menu li').bind('click', function(e){
			$('.color .menu li').each(function(index){
				$(this).removeClass('active');
			});
			$(this).addClass('active');
		});
		$('.color .menu').touchScrolling();
		$('.touch-menu-la').swipe({
			swipeStatus:function(event, phase, direction, distance, duration, fingers, fingerData, currentDirection){
				if (currentDirection == 'up' || currentDirection == 'down'){
					//console.log('scroll');
					var s = '', str = $(this).css('transform');
					for(var i = str.length - 1; i >= 0; i--){
						if (str[i] == ',')
							{
								for(var j = i - 1; j >= 0; j--){
									if (str[j] != ',')
										s += str[j];
									else
										break;
								}
								var _s = '';
								for(var k = s.length - 1; k >= 0; k--){
									_s += s[k];
								}
								s = _s;
								break;
							}
					}
					_width_scroll = width - 20;
					if (s < _width_scroll)
					{
						var startPos = 0;
			        	self = $('.color .menu');
						self.unbind();
			        	self.bind('touchstart', function(e) {
			        		startPos = self.scrollTop() + e.touches[0].pageY;
			        		e.preventDefault();
			        	});
					    self.bind('touchmove', function(e) {
					        //self.scrollTop(startPos - e.touches[0].pageY);
					        self.scrollTop(pos);
					        e.preventDefault();
					    });
					    self.bind('touchend', function(e) {
					        self.scrollTop(pos);
					        self.unbind();
					        self.bind('touchstart', function(e) {
				        		startPos = self.scrollTop() + e.touches[0].pageY;
				        		e.preventDefault();
				        	});
						    self.bind('touchmove', function(e) {
						        self.scrollTop(startPos - e.touches[0].pageY);
						        e.preventDefault();
						    });
					        e.preventDefault();
					    });
					    self.bind('touchcancel', function(e) {
					        self.scrollTop(pos);
					        self.unbind();
					        self.bind('touchstart', function(e) {
				        		startPos = self.scrollTop() + e.touches[0].pageY;
				        		e.preventDefault();
				        	});
						    self.bind('touchmove', function(e) {
						        self.scrollTop(startPos - e.touches[0].pageY);
						        e.preventDefault();
						    });
					        e.preventDefault();
					    });
					}
					else
						pos = $('.color .menu').scrollTop();
				}
			},
			threshold:0
		});
		window.addEventListener("resize", function(){
			//orientation landscape and portrait
			width, width_w = window.innerWidth;
			width_h = window.innerHeight;
			if (width_w > width_h)
				width = proc * width_h / 100;
			else
				width = proc * width_w / 100;
			$('.content').css({'height' : width_h - 40 - 30});
		}, false);
	</script>
</body>
</html>